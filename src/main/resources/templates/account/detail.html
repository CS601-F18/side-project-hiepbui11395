<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Account Info</title>
	<th:block th:include="/_static"></th:block>
</head>
<body>
	<th:block th:include="/_menu"></th:block>

	<div class="page-title">Account Info</div>
	<div class="account-container">
		<ul>
			<li>Username: <!--/*@thymesVar id="account.username" type="account"*/-->
			<span th:utext="${account.username}"></span></li>
			<li>Email: <span th:utext="${account.email}"></span></li>
			<li>Games:
				<table border="1">
					<thead>
						<tr>
							<th>Game</th>
							<th>Time</th>
						</tr>
					</thead>
					<tbody>
					<th:block th:each="gameWithTime : ${games}">
						<tr>
							<td th:text="${gameWithTime.game.name}"></td>
							<td >
								<ul>
									<li th:each="gameTime: ${gameWithTime.gameTimes}"
										th:utext="${gameTime}"></li>
								</ul>
							</td>
						</tr>
					</th:block>
					</tbody>
				</table>
				<button id="myBtn">Add games</button>
			</li>
		</ul>
	</div>

	<th:block th:include="/_footer"></th:block>


	<!-- The Modal -->
	<div id="addGameModel" class="modal">

		<!-- Modal content -->
		<div class="modal-content">
			<div class="modal-header">
				<span class="close">&times;</span>
				<h2>Add game</h2>
			</div>
			<div class="modal-body">
				<form autocomplete="off">
					<div class="autocomplete">
						Game: <input id="gameName" type="text" name="game" required>
					</div>
					<br /> <label for="startTime">Start time: </label> <input
						id="startTime" type="time" name="startTime"><br /> <label
						for="endTime">End time: </label> <input id="endTime" type="time"
						name="endTime"><br />
					<button id="btnAddGame">Submit</button>
				</form>
			</div>
			<div class="modal-footer">
				<h3></h3>
			</div>
		</div>

	</div>
</body>
<script>
    let games;
	$.ajax({
		type : "GET",
		url : "/api/games",
		success : function(result) {
			games = result;
			autocomplete(document.getElementById("gameName"), games);
		},
		error : function(result) {
			// do something.
		}
	});

	// Get the modal
	let modal = document.getElementById('addGameModel');

	// Get the button that opens the modal
    let btn = document.getElementById("myBtn");

	// Get the <span> element that closes the modal
    let span = document.getElementsByClassName("close")[0];

	// When the user clicks on the button, open the modal 
	btn.onclick = function() {
		modal.style.display = "block";
	}

	// When the user clicks on <span> (x), close the modal
	span.onclick = function() {
		modal.style.display = "none";
	}

	// When the user clicks anywhere outside of the modal, close it
	window.onclick = function(event) {
		if (event.target == modal) {
			modal.style.display = "none";
		}
	}
	$(document).ready(function() {
		$("#btnAddGame").click(function(e) {
            e.preventDefault();
            let startTime = $('#startTime').val().split(':');
            let startTimeMinutes = (+startTime[0]) * 60 + (+startTime[1]);
            let endTime = $('#endTime').val().split(':');
            let endTimeMinutes = (+endTime[0])*60 + (+endTime[1]);

			$.ajax({
				type : "POST",
				url : "/account/games/add",
				data : {
					name : $("#gameName").val(),
					startTime : startTimeMinutes,
					endTime : endTimeMinutes
				},
				success : function(result) {
					alert('ok');
				},
				error : function(result) {
					alert('error');
				}
			});
		});

	});
</script>
</html>